# GAMES 101 课程 现代计算机图形学入门
[项目页面](http://www.cs.ucsb.edu/~lingqi/teaching/games101.html )  
[bilibili回放视频](https://www.bilibili.com/video/BV1X7411F744?p=2)  
```
ᵃ ᵇ ᶜ ᵈ ᵉ ᶠ ᵍ ʰ ⁱ ʲ ᵏ ˡ ᵐ ⁿ ᵒ ᵖ ʳ ˢ ᵗ ᵘ ᵛ ʷ ˣ ʸ ᶻ 上标
⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁺ ⁻ ⁼ ⁽ ⁾


 ₀ ₁ ₂ ₃ ₄ ₅ ₆ ₇ ₈ ₉ ₊ ₋ ₌ ₍ ₎ 下标


 上标：

⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁺ ⁻ ⁼ ⁽ ⁾ ⁿ º ˙

㆒㆓㆔㆕㆖㆗㆘㆙㆚㆛㆜㆝㆞㆟㆒㆓㆔㆕㆖㆗㆘㆙㆚㆛㆜㆝㆞㆟

ᵃ ᵇ ᶜ ᵈ ᵉ ᶠ ᵍ ʰ ⁱ ʲ ᵏ ˡ ᵐ ⁿ ᵒ ᵖ ᵒ ʳ ˢ ᵗ ᵘ ᵛ ʷ ˣ ʸ ᙆ 
ᴬ ᴮ ᒼ ᴰ ᴱ ᴳ ᴴ ᴵ ᴶ ᴷ ᴸ ᴹ ᴺ ᴼ ᴾ ᴼ̴   ᴿ ˢ ᵀ ᵁ ᵂ ˣ ᵞ ᙆ

  ˀ ˁ ˤ ʱ ʴ ʵ ʶ  ˠ  ᴭ ᴯ ᴲ ᴻ ᴽ ᵄ ᵅ ᵆ ᵊ ᵋ ᵌ ᵑ ᵓ ᵚ ᵝ ᵞ ᵟ 
  ᵠ ᵡ ᵎ ᵔ ᵕ ᵙ ᵜ ᶛ ᶜ ᶝ ᶞ ᶟ ᶡ ᶣ ᶤ ᶥ ᶦ ᶧ ᶨ ᶩ ᶪ ᶫ ᶬ ᶭ ᶮ ᶯ
   ᶰ ᶱ ᶲ ᶳ ᶴ ᶵ ᶶ ᶷ ᶸ ᶹ ᶺ ᶼ ᶽ ᶾ ᶿჼ ᒃ ᕻ ᑦ ᒄ ᕪ ᑋ ᑊ ᔿ ᐢ ᣕ ᐤ ᣖ 
   ᣴ ᣗ ᔆ ᙚ ᐡ ᘁ ᐜ ᕽ ᙆ ᙇ ᒼ ᣳ ᒢ ᒻ ᔿ ᐤ ᣖ ᣵ ᙚ ᐪ ᓑ ᘁ ᐜ ᕽ ᙆ ᙇ 
   ⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁺ ⁻ ⁼ ˂ ˃ ⁽ ⁾ ˙ * º

下标：

₀ ₁ ₂ ₃ ₄ ₅ ₆ ₇ ₈ ₉ ₊ ₋ ₌ ₍ ₎ ₐ ₑ ₒ ₓ ₔ 

ₐ ₔ ₑ  ᵢ  ₒ  ᵣ ᵤ ᵥ ₓ ᙮ ᵤ ᵩ ᵦ  ˪ ៳ ៷ ₒ ᵨ  ៴ ᵤ ᵪ ᵧ

ₐ ₑ ₕ ᵢ ⱼ ₖ ₗ ₘ ₙ ₒ ₚ ᵣ ₛ ₜ ᵤ ᵥ ₓ 

 ᵅ ᵝ ᵞ ᵟ ᵋ ᶿ ᶥ ᶲ ᵠ ᵡ ᵦ ᵧ ᵨ ᵩ ᵪ
●● ··  ∫ ∞ 

1 Α α alpha a:lf 阿尔法
2 Β β beta bet 贝塔
3 Γ γ gamma ga:m 伽马
4 Δ δ delta delt 德尔塔
5 Ε ε epsilon ep`silon 伊普西龙
6 Ζ ζ zeta zat 截塔
7 Η η eta eit 艾塔
8 Θ θ thet θit 西塔
9 Ι ι iot aiot 约塔
10 Κ κ kappa kap 卡帕
11 ∧ λ lambda lambd 兰布达
12 Μ μ mu mju 缪
13 Ν ν nu nju 纽
14 Ξ ξ xi ksi 克西
15 Ο ο omicron omik`ron 奥密克戎
16 ∏ π pi pai 派
17 Ρ ρ rho rou 肉
18 ∑ σ sigma `sigma 西格马
19 Τ τ tau tau 套
20 Υ υ upsilon jup`silon 宇普西龙
21 Φ φ phi fai 佛爱
22 Χ χ chi phai 凯
23 Ψ ψ psi psai 普西
24 Ω ω omega o`miga 欧米伽
```

## 第1节 介绍

四个部分：
    光栅化 - 三维世界显示为二维平面。游戏中就是实时的
    曲线和曲面 - 如何表示，变化时保持结构
    光线追踪 - 慢。  实时光线追踪
    动画/模拟/仿真 

教材 The tiger book - Fundamentals of Computer Graphics

## 第2节 线性代数

数学向量 就是 物理矢量
点乘 - `a*b = ||a||*||b||*cos<ab`  可以用来算角度  `cos<ab = a*b/||a||*||b||` 
    点乘满足 交换率  分配率
    计算方法- 对应元素相乘再加起来
    计算夹角， 计算投影， 计算两个方向是否接近， 计算一个前与后的方向关系
叉乘 - `axb = -bxa   ||axb|| = ||a||*||b||*sin<ab`  得出与a,b都垂直的向量
    四指是旋转方向，拇指是向量方向。 所以 axb 与 bxa 方向相反
    与自己的叉乘是0， 0向量
    满足分配率结合率， 不满足交换率  
    用途  判定左/右 或 判定内/外  
    右手系 X x Y = Z 

任意一点可以分拆到垂直坐标系的三个轴上。  

矩阵

矩阵乘积 - (MxN)(NxP) = (MxP) 
    没有交换率
    有结合率和分配率
单位矩阵 - 对角线上全是1，其它位置全是0的矩阵
向量的点乘和叉乘都可以写成矩阵的形式。  

## 第3节   变换   
0'
Announcements 
不能用qq邮箱注册作业系统

1'
前节课复习
向量 点乘 叉乘  矩阵计算

2'  变换
- 为什么学变换
- 2D 变换有：旋转  缩放 切变（shear)
- 齐次坐标(Homogeneous coordinates)
- 组合变换
- 3D 变换

3' 为什么学变换
- 模型变换 Modeling 
    Modeling:translation 描述摄像机的移动
    Modeling:rotation  带关节的模型，各个关节和部分的移动
    Modeling:scaling   把一个模型压扁，拉伸的动画
- 视图变换 Viewing  5'40
    Viewing:(3D to 2D) projection  从3D模型中生成一幅 2D 图像(光栅化成像)

6'45 二维变换 2D transformation

7' 缩放矩阵  x -> x'(x prime)  
```
[x'] = [s 0][x]
[y']   [0 s][y]  s0.5

[x'] = [sx 0][x]
[y']   [0 sy][y]  s0.5,1.0  x,y 缩放程度不一样   
```

10'27  水平反射（对称）  Horizontal reflection
x' = -x
y' = y

11'20  镜像矩阵 
```
[x'] = [-1 0][x]
[y']   [0  1][y]  
```

11'46 切变矩阵 shear matrix
Horizontal shift is 0 at y=0
Horizontal shift is a at y=1
Vertical shift is always 0
```
[x'] = [1 a][x]
[y']   [0 1][y]  
```

16'14 旋转矩阵  
都是相乘的
不说别的信息时，谈旋转默认是原点为中心，逆时针旋转
R45 就是以原点为中心逆时针旋转45度
17'32  列出旋转矩阵
```
Rθ = [cosθ -sinθ]
     [sinθ  cosθ]
```
18'30 手动推导旋转矩阵演示
一个点到另一个点，就是推导出矩阵的四个数，矩阵肯定是2x2的。 对于任意的点都满足这个公式，所以找个特殊点计算出矩阵就可以了。 一般取单位长度上的点。 (1,0) 或 (0,1)   
24'09 线性变换 前面讲的几个变换都是2x2矩阵与原来相乘的形式，这种的叫线性变换。   
```
x' = M x 
[x'] = [a b][x]
[y']   [c d][y]  
```

26' Homogeneous coordinates  齐次坐标
为什么要用到齐次坐标呢，为了把平移变换也统一到矩阵乘向量的方法上来。  
因为平移有对常量的计算，需要特殊表示。     

32'37 给出齐次坐标矩阵  
2D point = (x,y,1)ᵀ
2D vector = (x,y,0)ᵀ  
为什么点和向量的表示方法是不一样的呢 ? 向量表示方向，向量有平衡不变性。 向量平移后，还是原来那个向量。 我们不希望它发生改变  


Matrix representation of translations  
```
[x']   [1 0 tx] * [x]   [x+tx]
[y'] = [0 1 ty] * [y] = [y+ty]
[w']   [0 0  1] * [1]   [ 1  ]
```

36'29 讲为什么分别加上 1 和 0  
vector + vector = vector
point - point = vector
point + vector = point
point + point = ? 点加点没什么意义，但牛人们扩充了点表示的意义。让 (x, y, w)ᵀ 表示的就是 （x/w, y/w, 1)ᵀ  w!=0, 那么这样 point + point 的结果就有意义了， 它表示的就是这两个点的中点！！ 妙啊

40' 仿射变换  affine transformations
affine map = linear map + translation
```
[x'] = [a b] * [x] + [tx]
[y']   [c d] * [y] + [ty]
```
Using homogenous coordinates:  
```
[x']   [a b tx]   [x]
[y'] = [c d ty] * [y]
[1 ]   [0 0  1]   [1]


S(sx,sy)  =  [sx 0  0]
             [0  sy 0]
             [0  0  1]
```
齐次坐标在表示2D变换时，最后一行都是[0 0 1]。 在投影变换时就不是了，这个以后会讲。  

44'  讲一些其它的变换
逆变换  Inverse Transform
M⁻¹ 
M⁻¹ is the inverse of transform M in both a matrix and grometric sense. 
一般矩阵的逆矩阵就是逆变换需要的矩阵， 逆变换就是把一个变换后的图形再变回改变之前的状态。 

46' 组合变换 
复杂的变换可以通过简单变换组合完成，组合的顺序很重要。  因为矩阵的乘法是不满足交换率的。 

在矩阵乘法的式子中，对最右边的列向量应用矩阵， 是从右向左应用的。 

51'10  很多个矩阵应用也跟两个一样，向多个推广就行。 不是从右到左  
Sequence of affine transforms A₁ A₂ A₃,...
    Compose by matrix multiplication
        Very important for performance!
矩阵没有交换率，但是有结合率，所以所有的变换先乘起来也是可以的，它还是一个3x3的矩阵。 这就说明一个3x3的矩阵可以用来表示非常复杂的变换，而不需要一个接一个的乘， 这样对效率就有了很大的提高。 


55' 分解变换  Decomposing Complex Transforms
比如我们会了图像在原点旋转的方法， 现在要按任意点c旋转，怎么做？ 
1 把要旋转的点平移到原点
2 按原点旋转
3 再平移回原来的位置。

T(c)●R(α)●T(-c)  

57'22 问题解答
结果没讲

58' 3维变换 3D Transforms
Use homogeneous coordinates again:
3D point = (x, y, z, 1)ᵀ  
3D vector = (x, y, z, 0)ᵀ  

齐次坐标的表示方式同理由2维推广到3维  

## 第4节 深入变换内容 Transformation Cont. 
0' 本节介绍

1' 来点上节的补充

R-α = Rαᵀ = Rα⁻¹ 
在数字上，如果一个矩阵的逆等于它的转置矩阵，我们管这个矩阵叫做正交矩阵。  

3'40 上节复习  

5'47 本节内容介绍
先讲 3D Transformations 
再讲 Viewing transformation  观测变换
    国内教材一般分为下面两个，没有合起来的名字，内容是一样的. 其实也就是这两种。
    - View（视图）/Camera transformation
    - Projection(投影) transformateion
        - Orthographic(正交) projection
        - Prespective(透视) projection

6'40 3D Transformations

In general, (x,y,z,w) (w!=0) is the 3D point:  (x/w, y/w, z/w, 1)  
齐次坐标的三维表示 ：  
```
[x']   [a b c tx]   [x]
[y'] = [d e f ty] ● [y]
[z']   [g h i tz]   [z]
[1 ]   [0 0 0 1 ]   [1]
```
8'47 缩放 Scale
```
S(sx,sy,sz) = [sx 0 0 0]
              [0 sy 0 0]
              [0 0 sz 0]
              [0 0  0 1]
```

平移 Translation
```
T(tx,ty,tz) = [1 0 0 tx]
              [0 1 0 ty]
              [0 0 1 tz]
              [0 0 0  1]
```

9'19  旋转 Rotation around x-, y-, or z-axis
```
Rx(α) = [1   0    0   0]
        [0 cosα -sinα 0]
        [0 -sinα cosα 0]
        [0   0    0   1]

Ry(α) = [cosα  0 sinα 0]
        [  0   1  0   0]
        [-sinα 0 cosα 0]
        [  0   0  0   1]

Rz(α) = [cosα -sinα 0 0]
        [sinα  cosα 0 0]
        [  0    0   1 0]
        [  0    0   0 1]
```

x, y, z 三个轴叉乘是每两个叉乘得第三个，因为y等于z叉乘x, 而不是x叉乘z, 所以在y轴的旋转阵列中， sinα 的排列方向与x,z轴的不一样， 因为是z,x的顺序，不是x,z的顺序。  


13' 把复杂旋转转换为简单旋转
Compose any 3D rotation from Rx,Ry,Rz?
    Rxyz(α,β,γ) = Rx(α)Ry(β)Rz(γ)

So-called Euler angles   分解出的三个角度叫做欧拉角  

Often used in flight simulaters: roll 绕飞机中轴转, pitch上下点头, yaw左右摇头

15'50 罗德里格斯旋转公式  Rodrigues' rotation formula
Rotation by angle α around axis n:  
```
                                         [0 -nz  ny]  
R(n,α) = cos(α)I + (1-cos(α))nnᵀ + sin(α)[nz  0 -nx]
                                         [-ny nz  0]
```
推导过程在补充材料中。 

21'26  今天的主要内容。 viewing 变换

24' 拍照模拟
人物站好位置  model transformation
选好相机位置  view transformation
咔！  projection transformation
mvp !!

25' 定义相机的向量和矩阵 Define the camera first

- 位置 Position  e 
- 拍照方向 Look-at / gaze direction  g 
- 向上的方向 Up direction  t 

27' 计算方式的转化
在相对运动系统中，相机与被拍物体同时运动，并相对静止时，与都静止时效果是一样的。  所以相机在运动时拍照可以转换为相机不动，整个世界在动，效果是一样的。   
在图形学里一般把相机转换为固定在原点，看向-z的方向，向上方向为y轴来进行计算。 

29'40 用一个矩阵把摄像机归零
Mview
- 把位置归零
- 把朝向转向-z
- 把向上方向转向 y
- x轴自动就归位了

30'32  给出矩阵 
齐次坐标转换方式，先旋转再平移
Mview = RviewTview  

先做平移，把位置e移到原点，很简单 
```
Tview = [1 0 0 -xe]
        [0 1 0 -ye]
        [0 1 0 -ze]
        [0 0 0  1 ]
```
再把拍照方向 g 转到 -Z, 向上的方向 t 转到 Y, (g x t) 转到 X . 
这个没学过，很难写，但是把单位向量 (0 0 1) 转到某个方向是会写的，那就可以先把单们方向转向 g t ,再求它的逆矩阵就可以了。  旋转矩阵
```
Rview⁻¹ = [x(gₓt) x(t) x(g)  0]
          [y(gₓt) y(t) y(-g) 0]
          [z(gₓt) z(t) z(-g) 0]
          [  0     0     0   1]    再转置一下就可以了

Rview = [x(gₓt) y(gₓt) z(gₓt) 0]
        [  x(t)   y(t)   z(t) 0]          
        [ x(-g)  y(-g)  z(-g) 0]
        [   0      0      0   1]          
```

[?] 第三个方向明明是被另两个就规定死了的，为什么也要写到矩阵里呢。 


35'13  简单总结

不管是模型还是视图，最后都是应用到模型上了，所以就被统称为；  
ModelView Transformation 

38'50  投影
正交投影 与 透视投影

42'30  贴了个链接
https://stackoverflow.com/questions/36573283/from-perspective=picture=to-orthographic-picture  

43' 正交投影
简单理解
    - 把相机归零
    - 把 z 坐标扔掉，就可以了
    - 把结果平移和缩放,放到[-1,1]² 矩形里。 约定俗成，方便后续计算。 

45'33 正式做法
把空间中任意一个立方体映射成一个标准立方体。  
We want to map a cuboid [l,r] x [b,t] x [f,n] to the "canonical" cube [-1, 1]³  
- Center cuboid by translating
- Scale into "canonical" cube

left < right   bottom < top  far < near. 因为是看向-z,所以f是比n小的。 
canonical  正则  规范 标准  

openGL 用的是左手系，所以 f 会大于 n , 但会导致 x 叉乘 y 不等于 z。 

49' 正交变换矩阵 
把中心点位置归零，边长缩放为2就可以了。 比如原来x轴方向长度 r-l,给它乘上 2/(r-l) 就缩放成2了。  

先缩放再平移  
```
Mortho = [2/(r-l)    0       0    0][1 0 0 -(r+l)/2]
         [   0    2/(t-b)    0    0][0 1 0 -(t+b)/2]
         [   0       0    2/(n-f) 0][0 0 1 -(n+f)/2]
         [   0       0       0    1][0 0 0     1   ]
```

50'58  小答疑

53' 透视投影
- 应用广泛
- 近大远小
- 平行线不再平行

55'47  复习齐次坐标
齐次向量乘以一个不等于0的数表示的点不变。 
(x,y,z,1) (kx, ky, kz, k)  (xz, yz, z², z) 都表示同一个点 (x, y, z)  


56'42 理解透视投影 
Frustum 锥台  截头锥体  cuboid 长方体  

透视投影是大面投影到小面上，分解开思路来做，把大的面先压缩到跟小面一样大小，再做正交投影就可以了。  
- First "squish" the frustum into a cuboid(n->n, f->f) (M[persp->ortho])  
- Do orthographic projection(M[ortho], already known!)

60' 挤压锥台时的规定  
1 近平面永远不变  
2 远平面z不变
3 远平面中心点位置不变


61'35 推导矩阵 比例关系   
远点挤压后  y' = (n/z)y   x' = (n/z)x

65'32 根据已知项推导矩阵
```
[x]  挤压后  [ nx/z ] 乘以z,等于 [     nx     ]
[y]    ==>   [ ny/z ]     ==    [     ny     ]
[z]          [unknow]           [still unknow]
[1]          [   1  ]           [      z     ]


4x4 矩阵             [x]     [  nx  ]
                     [y]     [  ny  ]
M(persp->ortho) 点乘 [z]  =  [unknow] 
                     [1]     [  z   ]
可以得出部分矩阵
                   [n 0 0 0]
                   [0 n 0 0]
M(persp->ortho)  = [? ? ? ?]
                   [0 0 1 0]
```

68'35 求第三行
两个条件：
- 近面上的点位置不会变化
- 远面上的点z值不会变化，中心点位置不变  

因为矩阵都是扩大z倍，近面上的就是扩大n倍 
```
[x]   [x]   [nx]                     [x]
[y] =>[y] ==[ny]   第三行   (? ? ? ?) [y]  = n² ,得出前两个数一定是0   (0 0 ? ?)
[n]   [n]   [n²]                     [n]
[1]   [1]   [n ]                     [1]
```
设置为 (0 0 A B) , 那么有  An + B = n²  , 远平面上中心点也是不变的，也得出一个式子 Af + b = f²。  
解了二元一次方程就得出  A = n + f , B = -nf  
得到压缩矩阵
```
                   [n 0  0   0 ]
                   [0 n  0   0 ]
M(persp->ortho)  = [0 0 n+f -nf]
                   [0 0  1   0 ]
```

M(persp) = M(ortho)M(persp->ortho)


## 第5节 三角形光栅化 Rasterization 1(Triangles)   
第一块重要部分

1'32 上节作业 作业0

4'17 上节回顾

6'25 本节内容 变换完就要光栅化
- Viewing 结束
- 光栅化 Rasterization
    - Different raster displays
    - Rasterizing  triangle
- 遮挡和可见性 Occlusions and Visibility

6'47 如何定义视锥体的大小
两个变量  长宽比(aspect ratio)和垂直可视角度(field if view   fovY)  
aspect 外观 方位  ratio 比率

11'16 把 fovY 和 aspect ratio 转换为 l,r,b,t  
tan(fovY/2) = t/|n|   aspect = r/t

14' MVP 之后 model view projection  
定义一下屏幕  
- 像素数组  an array of pixels
- 分辨率 Size of the array: resolution
- 光栅化显示器 A typical kind of raster display

17' 光栅和像素
Raster == screen in German
- Rasterize == drawing onto the screen

Pixel (FYI, short for "picture element")
- For now : A Pixel is a little square with uniform color
- Color is a mixture of (red, green, blue)  

18'08 定义下屏幕空间  
左下角为坐标系(0, 0), 向右是 X，向左是 Y  
第个像素用坐标(x, y) 表示   
像素范围从(0,0)到(width-1, height-1)  
像素的中心是 (x+0.5, y+0.5)   
每个像素会占一个单位的长和宽，所以整个屏幕空间就是从 (0,0) 到 (width, height) 最右上角像素坐标是(width-1, height-1), 它的右上角覆盖到了(width, height)  

21'20 标准立方体转换到屏幕上  Canonical Cube to Screen

22' 先不管z , 转换x y
把 [-1,1]² 变换到 [0,width]x[0,height]  
转换矩阵, 先缩放，再把左下角移到 (0,0) 的位置 
```
              [width/2     0    0 width/2 ]
M(viewport) = [   0    height/2 0 height/2]
              [   0        0    1     0   ]
              [   0        0    0     1   ]
```

25'38 绘图机器  

26'30 不同的光栅显示设备
示波器  Jerobeam Fenderson  CRT屏幕 阴极射线管  Cathode Ray Tube 

31' 隔行扫描，提高效率。 高速运动会造成画面撕裂

32'37 DAC Digital to Analog Convertors
Analog -> RGB

34'16 LCD  Liquid Crystal Display
液晶显示器  原理就不管了

37'17 LED Light emittig diode   

37'58 Electrophoretic (Electronic Ink) Display  
电子墨水屏   刷新率很低 

39'12 Rasterization 怎么样画到显示设备上  

40'24 三角形
- 最基础的多边形
    - 可以用来分解其它多边形
- 独特的属性
    - 一定是平面的  Guaranteed to be planar
    - 三角形的内外是非常清楚的，内部不可能有洞
    - 三角形三个顶点的属性可以渐变插值的  

42'20 判断像素与三角形的位置关系

43'55 采样方法
把一个函数进行离散化。  We can discretize a function by sampling.  

46'10 判断像素中心是不是在三角形内部
利用之前讲的向量叉乘的方法，与三条边的方向关系都一样的就是在内部。  

54'21 怎样不检查全部像素点
找出最大和最小坐标，圈出矩形，矩形外面的就不需要检查了。  

58' Rasterization on Real Displays  
iPhone 6S 与 Galaxy S5  

61' 打印机 减色系统 

62'20 失真/锯齿  Aliasing (Jaggies)  
下节讲反锯齿  


## 第6节 光栅化2 Rasterization 2 Antialiasing and Z-Buffering 
反走样 和 深度缓冲  

1' 这节课要难得多  
- 学过信号处理才好
- 没学过的就多看几遍

2'40 上节回顾

3'24 反走样  

4' 回顾 检测三角形内外

ubiquitous 无处不在的 

5'52 采样在图形学是广泛存在的 
位置采样  
时间采样  

8'30 Sampling Artifacts 瑕疵  
(Error/Mistakes/Inaccuracies) in Computer Graphics

9'20 锯齿  摩尔纹  采样车轮倒转  
Jaggies- sampling in space  
Moire - under sampling images  
Wagon wheel effect - sampling in time  

12'20 原因  信号变化太快但采样太慢  

13'18 怎样反走样  
先模糊（滤波）再采样  
先采样再模糊  Blurred Aliasing  

17'22 频域  Frequency Domain   
周期是函数重复自己的长度 ， 是频率的倒数  

19'47 微积分中的级数展开  
任何一个周期函数都可以写成一系列正弦和余弦函数的线性组合，以及一个常数项。  

22'52 傅里叶变换  逆傅里叶变换  Fourier transform

24' 不同的函数展开后就是不同频率的函数的组合
傅里叶变换就是把函数变成不同频率的段，把这不同的段显示出来。  

25' 展示采样频率对采样结果的影响   

27'37 通过频率来分析走样到底是怎么回事  
走样就是两个频率不同的函数在同一个采样操作下得到了一样的结果。  

29'23 滤波 Filtering = Getting rid of certain frequency contents  
傅里叶变换把函数从时域变到频域。  
对于一张图片变成频率空间后，成了一张中间发亮的图。  中间是低频信息，外围是高频信息。  
交叉的十字亮线是边界重复产生的高频信号。 （图片被当成横竖都是重复的来处理）  


33'28 高通滤波 只留下高频信息 High-pass filter  

35' 为什么高频信息对应边界呢  

36'30 低通滤波 Low-pass filter  
低频信息就是模糊

38'  中通

39'53  Filtering = Convolution 卷积  （=Averaging 平均)  

40'48 卷积  
窗口大小对原数据进行加权平均合并处理  

43'24 卷积定理 太长不记。。。  
时域的卷积 等于 频域的乘积
卷积的两种方式：
1 图像直接卷积核处理

2 图像时域转成频域，乘卷积核的频域，再转回时域

44'30 图像示例

47'51 卷积核（滤波器）
box 滤波器频域只有低频信息，乘了图片频域后只留下低频信息，所以叫低通滤波器。   

Boc Function = "Low Pass" Filter  
盒子越大 频率越低  Wider Filter Kernel = Lower Frequencies  

51'37 采样就是重复频率/频域上的内容 Sampling = Repeating Frequency Contents

52' 例子
怎么这里又讲时域上的乘积等于频域上的卷积，是不是讲反了？？？？？

55'10 走样产生的原因   
采样慢了，频谱上信号就太密集，产生重叠。 就发生了走样  

57'50 反走样
1 增加采样率  受制于设备物理限制  
2 反走样 先通过低能滤波，把频谱变窄，再采样 

62'30 对每个像素按覆盖面积进行卷积

65'11 近似算法 Antialiasing By Supersampling(MSAA)
把物理上的一像素在逻辑上分成4x4(nxn)的区域，对每个一进行计算，结果平均做这整体像素的结果 。  

MSAA 不是提高分辨率，也没有提高采样率，只是计算了模糊的比例。  

70'42 No free lunch! 
- What's the cost of MSAA?  计算量大了呗

73'44 其它的抗锯齿方法  
FXAA Fast Approximate AA  
TAA  Temporal AA

76'50 扩展总结  
Super resolution / super sampling  
- From low resolution to high resolutin  
- Essentially still "not enough samples" problem  
- DLSS (Deep learning Super Sampling)  


## 第7节 着色1 Shading 1 (Illumination, Shading and Graphics Pipeline)  

0' 以前作业  

2'20 回顾  
光栅化

4'13 本节内容简介  
可见性 / 遮挡  Visibility/ occlusion
    - Z-buffering
Shading
    - Illumination & Shading
    - Graphics Pipeline  

04'51 可见性  
从远到近把物体画在屏幕上，逐层覆盖 Painter's Algorithm  
但有些情况深度不好解决  

还有些情况是面互相覆盖，就没法按顺序画出来  

10'35 深度缓存  
每个像素的深度记录下来，像素就不会互相覆盖  
idea:
    - Store current min.z-value for each sample(pixel)  
    - Needs an additional buffer for depth values  
        - frame buffer stores color values  
        - depth buffer(z-buffer) stores depth 

IMPORTANT: 为了简单我们假设 z 永远是正值。 z 越小就越近，越大则越远   

13'51 图片举例  
深度图 近的点越黑 远的点越白  

15'06 如何记录深度图   
画每一个面时，记录像素对应点的深度。 有更浅的深度被画到这个像素时，就记录新的深度。  

18' 伪代码演示  

18'58 图片演示代码  

23'45 算法复杂度  
- 线性复杂度 O(n) for n triangles (assuming constant coverage)  
- 因为只记录了最小值， 并没有排序   

26'30 画每个图形的选择顺序是不影响的

28'20 所有GPU里都硬件实现了这个算法  

29'42 小问答  
透明物体处理不了。。。

30'51 小回顾，学了什么  

33' 为什么要着色  

34' 图片展示着色效果

35' 着色  
对不同物体应用不同材质  

37'30 一个简单的着色模型  （Blinn-Phong Reflectance Model ）
杯子图展示各种反射情况

42'30 着色需要的各种参数定义 着色有局部性 Shading is Local  
光照是考虑每个一物体的点。  可以认为是小平面。  
平面 shading point
Inputs: 
    - 观察方向 Viewer direction, v
    - 法线 Surface normal, n
    - 光照方向 Light direction, l 
        (for each of many lights)
    - 表面属性 Surface parameters
        (color, shininess, ...)

45'22 不考虑着色外的物体  
着色时不考虑阴影  

47'05 漫反射  

47'58 不同的情况
角度不同接受的光线是不同的  
Lambert's cosine law  

53'17 光的衰减  
I/r²  

57'40 光强度计算  
L(d) = k(d) (I/r²) max(0, n●l)    

L(d) 漫反射反射的光 diffusely reflected light  
k(d) 漫反射系数（颜色） diffuse coefficient (color)  
I/r² 到达着色点的能量 energy arrived at the shading point  
max(0, n●l) 根据余弦定理，因为夹角收到的能量不是全部。 余弦计算出负值也没什么用 energy received by the shading point   

62' 图片演示漫反射  

65'19 回答问题   

## 第8节 着色2 Shading 2 (Shading, Pipeline and Texture Mapping)  

1' 作业回顾

2'55  上节回顾

6'05 高光项 Specular Term(Blinn-Phong) 布林-冯模型   光照模式支持

强度 intensity depends on view direction  
    - Bright near mirror reflection direction  

8'21 半程向量 h   
入射与出射的角平分线  bisector  
角平分线就是两个向量相加，再长度缩放为1
h = bisector(v,l) = (v + l)/ ||v+l||

9'05 看半程向量与法线方向是否接近，就相当于观察方向与镜面反射方向是否接近  
如果接近，那么对于夹角 α , cosα 就接近1. 相乘就得到高光的强度。   
然后 Blinn-Phong 是一个简单模型，就没考虑入射角度的强度损失。 

L(s) = k(s) (I/r²) max(0, cosα)ᵖ  = k(s) (I/r²) max(0, n●h)ᵖ 
L(s)  高光反射量  specularly reflected light  
k(s)  高光系数  specular coefficient   

10'46 为什么用 n h 夹角，不用 v 和 反射光的夹角 
因为半程向量好算

11'46 指数p是什么？  
cosα 值太大，在大的角度时也能看到高光， 加个指数后，把高光范围限制在更小的范围内。  
正常情况下指数用 100-200

13'50 图片演示  

14'45 环境光照项  Ambient Term
环境光不依赖任何事情  
    - 添加常数的光照颜色值,假设环境光是个固定值 Iₐ   
    - 这是近似/模拟的，真正的环境光非常复杂  

Lₐ = kₐIₐ  
Lₐ  reflected ambient light  
kₐ  ambient coefficient  

16'55 图片演示  
Ambient + Diffuse + Specular = Blinn-Phong Reflection  
L = L(a) + L(d) + L(s)
  = kₐIₐ + k(s) (I/r²) max(0, n●h)ᵖ + k(d) (I/r²) max(0, n●l)   

18'26 回答问题

20'35 着色频率  shading frequencies
应用到面上  
应用到顶点上  
应用到像素上  

23'26 Flat shading  - shade each triangle  
按三角面着色  
对光滑曲面不太好  

24'02 Gouraud shading - shade each vertex
高氏着色  高洛德着色 
对每个顶点着色   

25'15 Phong shading  - shade each pixel  
逐像素着色  

27'  图片演示
面很多的情况下，各种就看起来差不多了。  

29'12  如何计算顶点的法线  
相邻的面的法线做个平均  
再加上点面的大小权重  


31'08 如何求逐像素的法
用到重心坐标，马上要讲  

32'10 回答问题


33' Graphics Pipeline  (Real-time Rendering Pipeline)
把所有的步骤联合起来就是图形管线。  

```
      |-----------<< Application              Input:vertices in 3D space
      |
Vertex Processing 
      |
      |       Vertex Stream                   Vertices positioned in screen space
      |
Triangle Processing
      |
      |       Triangle Stream                Triangles positioned in screen space
      |
  Rasterization
      |
      |       Fragment Stream                Fragments (one per covered sample)
      |
Fragment Processing
      |
      |       Shaded Fragments               Shaded fragments
      |
Framebuffer Operations
      |
      |-------------->> Display              Output: image(pixels)
```

显卡用来干这些  

37'28 例子演示  

40'30 着色器编程 Shader Programs  
- Program vertex and fragment processing stages
- Describe operation on a single vertex(or fragment)  

写 shader 一般是能在硬件上执行的语言  GLSL 是openGL 的  
shader 只控制一个像素的执行，没有for循环  

vertex shader   顶点着色嚣
fragment shader  像素着色嚣

46'  整个管线学完了 理论上可以自己写渲染代码了

47' shadertoy.com  在线shader

49'18 说下现代图形学的发展  
游戏引擎  
GPU  
更多的 shader   
GPU 就是个高度并行的计算核心  

54'09 回答问题  
并没有  

55' 纹理映射  Texture Mapping
定义任何一个点的基本属性  

56'50 怎么定义  
物体表面是二维的，表面就可以和一张图对应  

61' 纹理上的坐标 (u,v)  

通常为了方便处理，u,v 范围都设置为 (0,1)  

65' 上下左右可无缝衔接的纹理块 tilable texture

65'47 通过三角形顶点uv 求内部点uv，插值  
Interpolation Across Triangles: Barycentric Coordinates  

66'30 回答问题  



## 第9节  Shading 3 (Texture Mapping cont.)

0' 作业

1'32 上两节回顾  

4' 今日内容
- 重心坐标 Barycentric cordinates  
- 纹理查询(怎么贴到表面) Texture queries  
- 纹理的其它应用 Applications of textures  


4'54 如何在三角形内部进行任意点的插值:用重心坐标 Interpolation across triangles: barycentric coordinates

5'18 为什么要插值   
在三角形内部 得到平滑过渡  

6'5  插值什么内容  
纹理坐标 颜色 法线   ， 基本上任意属性都可以

7'29 怎样插件？ 重心坐标
给定一个三角形ABC, 三角形内的一个点都可以表示成 (x,y)= αA + βB + ΓC    
要满足  α + β + Γ = 1，  
而且三个值都是非负的，如果不满足这个，这个点可能是在三角形之外，但在三角形所在的平面内。  

满足这些条件时， 用 (α, β, Γ) 做为一个重心坐标来表示三角形内的一个点。 (其实两个值就够了，因为它们和等于1)  

11'  `A = 1*A + 0*B + 0*C A = (1,0,0)`

12'40  求任意点坐标
用分成的三个小三角形与总的面积比，

14'45 重心的重心坐标就是 (1/3, 1/3, 1/3)

15'25 求任意点重心坐标的公式  
一个三角形 ABC，其内部一点 (x,y), 重心坐标是：
```
     -(x - xB)(yC - yB) + (y - yB)(xC - xB)
α = ------------------------------------------
     -(xA - xB)(yC - yB) + (yA - yB)(xC - xB)

     -(x - xC)(yA - yC) + (y - yC)(xA - xC)
β = ------------------------------------------
     -(xB - xC)(yA - yC) + (yB - yC)(xA - xC)

Γ = (1 - α - β)
```


16'30 用重心坐标做插值  
任意属性 V 都可以用三个顶点的属性表示  V = αV(A) + βV(B) + ΓV(C)   

17'51 重心坐标在投影时不保证是不变的  
所以三维和二维投影是不对应的，投影后的属性值要投影回3D取值计算相应的插值属性。   

20'48 把纹理应用到渲染中  
已知点
求出重心坐标  
查出对应纹理的值  
就可以用了  


22'53 纹理放大 Texture Magnification   纹理太小怎么办  
纹理上的像素  A pixel on a texture - a texel (纹理元素， 纹素)  

Nearest 放大的格子
Biliner 双线性插值  有点模糊
Bicubic 效果更好一些


25'54  双线性插值  
找临近的四个点，按距离做权重平均  
先做水平插值， 把得到的两个点再进行竖直插值得到所求点的值。  
先竖直再水平也是一样的  

32'19 Bicubic 双向立方插值  
取16个点，运算量加大，质量提高   

34'10 Texture Magnification(hard case)  What if the texture is too large?

35' 纹理太大怎么办  
走样  锯齿与摩尔纹  

36'50 为什么走样  
3D 中远景的投影上的像素会覆盖更多纹理像素，平均就会走样  

38'10 超采样解决，但计算太多   

39' 理论分析走样  
采样频率低

40'40 另一种理解问题的方式  
不采样，用查询  
区域查询 范围查询  

43'26 MipMap  Allowing(fast, approx, square) range queries
只能做正方形的查询  
先给图形生成小图，

48' 存储量只多了 1/3 

50'11 怎么查询  

51' 把像素近似成一个正方形  

54'27 怎么去查找这个正方形  
根据边长算出在第几层会缩成一个点，再到相应的层上去查。  

层数 D = log₂L   

55'57  图片演示  

57'50 不是整数层的怎么办  
再做插值 三线性插值  
上下层各做一遍双线性插值，得到的值再做插值。  

60'18 MipMap 是否真能完全解决问题  
远处的模糊过度了  overblur

62'33 各向异性过滤  Anisotropic Filtering  
Ripmap
屏幕上的像素映射到纹理上可能不是正方形  
各向异性可以查询矩形映射的区域，对于斜的还是不太好。  


66'40 EWA filtering
- Use multiple lookups
- Weighted average
- Mipmap hierarchy still helps
- Can handle irregular footprints  

68'15 高级纹理方法  Advanced Texturing Methods 



## 第10节 几何 Geometry 1 (Introduction)  


1' 主要内容介绍  

2'30 作业介绍  
添加了作业FAQ  

3'36 着色回顾

5'27 上节回顾  

6'41 环境光照  

7' 纹理高级应用  
In modern GPUs, texture = memory + range query(filtering)  

Many applications
- 环境光照 Environment lighting
- Store microgeometry
- Procedural textures
- Solid modeling
- Volume rendering

8' 环境光照展示  

12'49 环境光记录方式  
Spherical Environment Map  

14'40 包围盒 Cube Map  
更少的拉伸，但光的方向需要计算在哪个面上  

17'18 纹理影响着色  凹凸贴图/法线贴图  

21'02 法线贴图  
Adding surface detail without adding more triangles  
- Perturb surface normal per pixel  
    (for shading computatins only)
- "Height shift" per texel defined by a texture
- How to modify normal vector? 
perturb 扰乱  

22'46 怎样扰乱  
- 假设原来是水平面，某点法线是 n(p) = (0,1)
- 计算该点在贴图上的导数 `dp = c*[h(p+1) - h(p)]` 
- 导数逆时针旋转90度就是法线。 n(p) = (-dp, 1).normalized()

25'49 3D 怎么计算  
u,v 两个方向分别计算，再合起来  

Original surface normal n(p) = (0,0,1)  

Derivatives at p are
- dp/du = c1 * [h(u+1) - h(u)]  
- dp/dv = c2 * [h(v+1) - h(v)]  

Perturbed normal is n = (-dp/du, -dp/dv, 1).normalized()  

(0,0,1) 与世界坐标的转换  

29'19 位移贴图 Displacement mapping  
位移贴图真正地移动顶点。
法线贴图在边缘处会有露馅，而且不会在自己身上产生阴影。   
位移贴图是真正移动了点，会产生阴影。  

位移贴图需要多边形足够多。  

33'40 3D Procedural Noise + Solid Modeling
3D 噪声

35'38 存储计算好的着色 Provide Precomputed Shading  

37'25 体积渲染 3D Textures and Volume Rendering

38'33 几何介绍  
各种各样的几何  

46' Many ways to represent geometry   
隐式的几何 Implicit

显式的几何 Explicit

46'38 隐式的
可知道点满足的关系，没有点的具体位置。  
函数表示的。  
很难看出具体是什么形状。  
看一个点在不在物体上是很方便。  


51'07 显式的表示: 
1 给出具体的点
2 通过参数映射的方式。 2D uv 映射成 3D

很容易看出具体是什么形状。  
不容易判断一个点在不在表面上，或在表面内还是外。  

55'26 小阶段总结  

56'30 More implicit representations in computer graphics

58'34 CSG  Constructive solid geometry
通过布尔运算组合隐式几何  

61'04 距离函数  Distance Functions (Implicit)

63'28 距离函数举例

68'36 距离函数可以做什么
举例

70'  Level Set Methods (Also implicit)  

72'40 分形 Fractals (Implicit)

75' 总结


## 第11节 几何2 曲线和曲面 Geometry 2 (Curves and surfaces)

2'19 上节回顾  


3'05 显式几何  Explicit representations in computer graphics  

3'27 各种方式
三角面 triangle meshes
贝塞尔曲面 Bezier surfaces
细分曲面 subdivision surfaces
 NURBS
点云 point clouds

3'37 最简单的点云   
足够密  
扫描一般用点云  
转换成多边形

5'54 多边形面  三角形 四边形  
最广泛应用的方式  

7'18 .obj 文件格式  The wavefront object file(.obj) format  

Just a text file that specifies vertices, normals, texture coordinates and their connectivities  

10'40 曲线 Curves   

13'03 贝塞尔曲线  Bezier Curves  

14'50 怎么画贝塞尔曲线 Evaluationg Bezier Curves(de Casteljau Algorithm)  
- 给定3个点(画二次贝塞尔曲线)  Consider three points (quadratic Bezier)  
a b c 三点， 从 a 到 c, b 为控制点。  假设a到c为1，给定一个比例t，连接ab,bc，不断同比切分连接线就可以确定在t时对应的曲线上的点。


19'27 给定4个点画贝塞尔曲线 
同样用线性递归插值  

21'50 动画演示  

22'10 Evaluating Bezier Curves Algebraic Formula  
Algebraic 代数的
三点方法中，比如b0 b1 b2, 知道一个t先求 两个点 b01 和 b11, 再用这俩点求 b02.  
b01(t) = (1-t)b0 + tb1  
b11(t) = (1-t)b1 + tb2  
b02(t) = (1-t)b01 + tb11 = (1-t)²b0 + 2t(1-t)b1 + t²b2  


27' 伯恩斯坦多项式   Bernstein form of a Bezier curve of order n:

28'43 可以在3D中控制贝塞尔曲线  

29'37 再看伯恩斯坦多项式  

31'06 贝塞尔曲线的性质  
- 起点经过第一个点 终点经过最后一个点
- 4个控制点的， 起点处切线是 3(b1 - b0)  结束处是 3(b3 - b2)
- 在仿射变换时可以直接变换控制点, 再重新画一条。 
    (只在仿射变换时是这样，其它变换是不可以的。 比如投影变换)
- 突包性质。 贝塞尔曲线一定在控制点定义的突包之内。  


37'08 逐段的贝塞尔曲线  Piecevise Bezier Curves
- 高阶的贝塞尔曲线不好控制  
- 逐段的就是每段用四个控制点定义一条曲线，把它们连起来  

44'01 连续性  
- 几何上的连续  C⁰ continuity
- 切线的连续 C¹ continuity
- 二阶导数的连续 C² continuity

47'30 样条曲线 other types of splines  

Spline  
- a continuous curve constructed so as to pass through a given set of points and have a certain number of continuous derivatives.
- In short, a curve under control

48'45 b样条  B-Splines  
B-splines  
- 基函数样条 Short for basis splines  
- Require more information than Bezier curves  
- Satisfy all important properties that Bezier curves have(i.e. superset)

极其复杂，就不讲了。  

52'03 深入学习曲线的资料介绍  

53' 曲面 Surfaces

53'40 贝塞尔曲面  
 先得一个方向的曲线，再来另一个方向就是面了。 

56'49 Evaluating Bezier Surfaces   
u,v 控制

58'54 Mesh Operations: Geometry Processing  
- 网格细分 Mesh subdivision
- 网格简化 Mesh simplification
- 网格规则化 Mesh regularization


## 第12节 Geometry 3 
shadow mapping 
光线追踪  

1' 作业介绍，补作业  

4' 大佬介绍  
图灵奖

5' 小打个广告。。

6'30 Back to Geometry

7'15 Mesh Subdivision (upsampling)  
8'12 Mesh Simplification (downsampling)  
8'40 Mesh Regularization(same #triangles)  

9'20 Subdivision  

11'10 Loop Subdivision  发明人叫loop, 与循环没关系  
一个三角形分成四个。 
新的顶点与旧的顶点分开处理。  
对一个新顶点，假设它在的边是三角形 ABD ABC 的邻边 AB.
新顶点  3/8 * (A + B) + 1/8 * (C + D)   

15'45 旧顶点   
定义几个事情  
n 旧顶点的度(连接的点个数)  
u 与n 有关的一个数。。。。  

旧顶点位置更新为 `(1-n*u)*original_position + u*neighbor_position_sum`   
neighbor_position_sum   周围点位置的平均

19'40 图片演示  

20'38 一般网格处理，不全是三角形 Catmull-Clark Subdivision (General Mesh)
定义几个概念  
非四边面(Non-quad face)
奇异点 度不是4的点。 Extraordinary vertex (degree != 4)

22'55 细分方法  
对于每个面，每个边和面都取中点，连起来就可以了。 

24'51 分析细分后结果  
增加了奇异点。  
原本两个5度的奇异点没变，又多了两个3度的奇异点。  
非四边形面在细分后就变成了四边形面，并且增加一个奇异点。  


28' 新点旧点如何更新位置  

30'12 图形演示  

31'30 动画演示  

33'37 Mesh Simplification  
几何的层次结构不好做  

38'31 怎么做 Collapsing an edge

39'20 哪些边要塌缩  二次误差度量 Quadric error metrics  
希望新的点可以最小化二次误差  
二次误差: 与机器学习的L2距离非常相似。  新点与旧面的距离平方和达到最小。 

42'20 那坍缩的结果就选使二次误差最小的那个位置。   
对每条边计算它的最小误差。 从最小的开始坍缩。  

44' 坍缩一条边后会引起其它边的变化。  
需要一个允许你取最小并允许动态更新值的数据结构--就是堆。  

45'52 那这种方法是不是全局最优方法呢？
不能保证。 但实际这样挺不错的。  

47' 图片演示  

49'30 光栅化时的阴影 Shadow mapping

52'33 怎么做
本质上是一种图像空间的做法。  
会产生走样。  
最重要的思想: 点不在阴影里说明点能被摄像机看到，也能被光源看到。  
shadow mapping 只能处理点光源。 生成硬阴影。  

54'54 Render from light  
1 从光源看向场景。 记录看到的点的深度。  

56'26 
2 从摄像机看向场景。 看到的点再投射到光源看到的图上，求深度，与步骤1记录的深度一样，说明两边都能看到。 如果比步骤1记录的深度大，说明只有摄像机能看到，那它就在阴影里。 

60'22 图片演示  

64'25 为什么会出现脏的地方呢  
- 浮点相等不好判断  
- 图上像素点可能会对应多个立体点，有误差  

解决方式可以用大于不用等于判断。 
还有些太接近的，再加个偏差， bias , 扩大精度范围。 但本质问题还是解决不了。  

67' shadow map 分辨率的问题，与场景不同的话，也会有走样的问题。 

68' shadow map 小总结  
虽然有很多缺点，但还是最广泛应用的方法。 
- 硬阴影
- 质量与阴影图(shadow map)的分辨率有关  

71'14 硬阴影与软阴影  Hard shadows vs. soft shadows
本影 半影 没影  

软阴影一定是因为光源有一

74'59 总结

## 第13节 Ray Tracing 1 (Whitted-Style Ray Tacing)  

3' 正式开讲 

3'26 光栅化的局限  
不适合做全局的效果  
- 阴影  
- 反光又不是纯镜面的 Glossy reflection
- 间接光照(光反射不只一次的情况)  

7'02 光栅化很快，但画质相对低  

8'02 光线追踪结果准确，但是很慢  
- `~10K CPU core hours to render on frame in production`  

10'30 基础的光线追踪算法

光线定义:  有三点  
1. 光线沿直线传播 Light travels in straight lines (though this is wrong)  
2. 光线不会碰撞，不处理这些情况 Light rays do not "collide" with each other if they cross (though this is still wrong)  
3. 光线从光源出发到达人眼(光线可逆，也可以从眼睛到光源)  Light rays travel from the light sources to the eye(but the physics is invariant under path reversal - reciprocity)  

13'46 光线追踪的早期研究  

15'24 Ray Casting  
1. 每个像素转化成一条光线 Generate an image by casting one ray per pixel
2. 检查光线与物体交点是否在光源可见范围 Check for shadows by sending a ray to the light  

16'55 图片演示  
眼睛与光源假定为点 ， 物体反光假定为完美反射和折射  
- 对每个像素，发出一条光线，记录碰撞的最近点。  
- 检查此点能不能到达光源

21'40 Recursive (Whitted-Style) Ray Tracing  
1979 年 74分钟渲染出的图，现在可以达到实时速度了。  

24' 图片演示  
光线可以弹射多次，反射或折射。  
每个弹射点都要进行着色计算。  
所有点的着色结果合并到像素中。  

28'20 光线分类  
眼睛直出的 primary ray  
经过反射折射的 secondary rays 
连向光源的 shadow rays  

29'28 图片演示  
透明物体后的阴影就没有那么暗   

31'10 求交点 Ray-Surface Intersection  
光线的数学定义  
起点记为 o， 方向记为 d  

Ray equation: 光线上任意一点 t  
r(t) = o + td  0<=t<无穷大

33'17  与球求交点  
Ray: r(t) = o + td
Sphere: p 满足 (p-c)² - R² = 0 , c 是球心
交点: 既在光线上又在球上的点。  两个函数都满足  

(o + td - c)² - R² = 0  
解方程求 t  
整理成一元二次方程  at² + bt + c = 0   t = (-b +- sqrt(b² - 4ac) ) / 2a  
```
a = d * d  
b = 2(o - c) * d  
c = (o - c)*(o - c) - R²  
```

36'52 推广  光线与隐式表面的交点  
交点既满足光线的方程又满足隐式表面的方程  

38'42 显示表面怎么做  
转换成光线与三角形求交点  
再扩展，可以求一个点是在物体内部还是外部。  (点与一个光线连线与物体的交点，在内部是奇数个，在外部是偶数个。 前提是物体是封闭的)  

40'30 怎么求与三角形的交点  
一个一个地来比较，太慢。 以后讲优化方式    

42'30 分解步骤  
- 先判断与平面是否相交  
- 再判断交点是否在三角形内  

平面的定义:  平面由一个法线 N 和一个经过的点 p' 
只要 p 满足 (p - p')●N = 0, p 就在这个平面上。   展开后就能转换成 ax + by + cz + d = 0  

46'43 解方程  
光线 r(t) = o + td
平面 (p - p')N = 0
合并后 (p-p')N=(o+td-p')N=0  
    (p' - o)N
t = ----------
       dN           确认 0<=t  
然后判断点是否在三角形内就可以了。  

48'31 MT算法 Moller Trumbore Algorithm  
后来就又找到了这个直接解有没有交点的方法。  
o + td = (1-b1-b2)p0 + b1p1 + b2p2   光线与重心坐标表示的三角形求解  
求 t b1 b2  因为 为o d p 都是三维的， 这就是个三元一次方程，可以求出来 (怎么变成三元一次呢，看不出来？？？)

不知道怎么算的，反正就求出来了。。。。

解出来验证一下，t 得是正的。 b1 b2 和 1-b1-b2 都是非负的那就在三角形内。   

52'48 加速求交计算 Accelerating Ray-Surface Intersection   
原来简单的算法  
- 计算每一个物体
- 选出最近的交点
    非非非非非非非常慢  

54'49 场景展示，复杂的场景计算量太大  

56'05 包围体积/包围盒 Bounding Volumes
用简单物体包围目标物体，如果碰不到包围盒就不必与物体计算了。   
碰到包围盒再与里面物体计算。  

58'20 理解长方体  
把长方体理解为三对面围成的空间。  
因为实际应用中通常是用与轴对齐的面围成的长方体来做包围盒。  

61'11 如何计算光线与包围盒的交点  
先用二维解释一下。  
先计算与一对面相交时的t范围， 再计算与另一对面相交时的t范围。 那这两个范围的交集就是与两个对面都相交的范围了。   妙啊  。。。   

65'53 三维就是再增加一维就行了  
思路是一样的。  

70' 如果 t 范围求出负值怎么办
如果是离开的时间是负的， 那就不可能有交点  
如果只有进入时间是负的，那光源就是在两面的中间。  或都最终结果，是在盒子中间。  

73'40 为什么用平行于轴的面做包围盒
因为算交点非常容易。  


## 第14节 计算加速和辐射动量学 Ray Tracing 2 (Acceleration & Radiometry)  

1' GTC 推迟  
DLSS 2.0 介绍  
- https://zhuanlan.zhihu.com/p/116211994  
RTXG 全局光照  
- https://developer.nvidia.com/rtxgi  

4'50 后面的课可就不容易了  

5'13 上节回顾  
Axis-Aligned Bounding Boxes (AABB)   

7'45 本节内容  

8' Uniform spatial partitions (Grids)  
1. 找到包围盒  
2. 生成格子
3. 与物体表面有相交的格子标记出来  

10'26 
光线与格子依次穿过  Step through grid in ray traversal order  
在相交的格子里判断与格子里物体是否有交点  
For each grid cell
    Test intersection with all objects stored at that cell  

14'16 效果如何  
分一个格子  没有加速
分太多格子  效率不好  

启发式  Heuristic:
    #cells = C * #objs
    C 约等于 27 in 3D  

15'30 图片演示  
分布均匀不不均匀的场景效率的不同  

17'43 空间划分  Spatial Partitions  

18'40 图片演示空间划分  
八叉树  Oct-Tree  
    第一次分八块，有物体就继续分，没有就不分了。 分到细度可以就不分了。   
砍刀树。。。  KD-Tree  
    与八叉树基本相同，但每次只分两叉  
BSP-Tree  
    与 KD-Tree 区别是砍得不是横平坚直的。  维度变高计算会变复杂。  


25'25 图片演示  
建立 KD-Tree  
划分完后，在叶子节点内部有的物体   

28' 定义数据结构  
沿着哪个轴分  
分在什么位置  
指针指向子节点  
物体存在叶子节点  

29' 图片演示 KD-Tree 加速  
从大向小逐层测试  

34'07 KD-Tree 的问题  
- 三角形与盒子是否相交不好判断，KD-Tree 不好建立  
- 一个物体会出现在不同的盒子里面  

38'33 物体划分 Object Partitions & Bounding Volume Hierarchy(BVH)  
把物体的三角形面划分两部分， 对每部分面求包围盒。  
叶子包围盒内面的数量够少后就停止划分。  

- 分物体好较好操作  
- 求包围盒也好操作  

问题是包围盒会相交  

44'48 如何划分  
- 轮选一个方向划分   Choose a dimension to split
- 选一个长的方向划分  Heuristic #1: Always choose the longest axis in node  
- 取位于中间(中位数)的面作划分 Heuristic #2: Split node at location of median object  

47'55 怎么取中位数  
排序 再取中间  O(nlgn)  
快速选择算法 : 给任意一列数， 要取第i大的数， 可以在 O(n) 时间内解决。 

51'42 数据结构 Data structure for BVHs
内部节点存储  
    - 包围盒
    - 子节点
叶子节点存储  
    - 包围盒
    - 内部物体(面)列表

52'10 算法伪代码   
```
Intersect(Ray ray, BVH node){
    if(ray misses node.bbox) return;

    if(node is a leaf node)
        test intersection with all objs;
        return closest intersection;

    hit1 = Intersect(ray, node.child1);
    hit2 = Intersect(ray, node.child2);

    return the closer of hit1, hit2;
}
```

53'52 空间划分与物体划分比较 Spatial vs Object Partitions  

55'35 Basic radiometry 辐射度量学  
从这开始就是国内图形学很少讲到的了  

57'29 为什么要讲辐射度量学呢  
精确地度量光  

60'53 学习什么内容  
辐射度量学表示如何去描述光照   
光的属性(空间中的属性， 不考虑波动性那些)  
- New terms: Radiant flux, intensity, irradiance, radiance  
在物理上准确地定义光照的方法  

62'21 学一个东西怎么去学  
为什么 WHY  
是什么 WHAT  
怎样的 HOW  

63'52 Radiant Energy and Flux (Power)  
能量 单位是焦耳 Radiant energy  
Radiant energy is the energy of electromagnetic radiation. It is measured in units of joules, and denoted by the symbol:
Q[J=Joule]  

单位时间内的能量 Radiant flux(power)  
Radiant flux(power) is the energy emitted, reflected, transmitted or received, per unit time.  
单位是 瓦特 流明(一个光源有多么亮)  
```
     dQ
φ = ---- [W=Watt] [lm = lumen]
     dt  
```

67'47 图片演示 flux   

68'40 Important Light Measurements of Interest  

Radiant Intensity  -- Light Emitted From a Source    
Irradiance  --  Light Falling On a surface  
Radiance  --  Light Traveling along a ray

70'04  Radiant Intensity
Definition : The radiant(luminous) intensity is the power per unit solid angle emitted by a point light source.   
点光源在每单位立体角上发射的能量。  
```
        dφ
I(w) = ----
        dw

[ W  ] [  lm                 ]
[----] [----- = cd = candela ]
[ sr ] [  sr                 ]
```

cd = candela  是标准单位制中的单位  
The candela is one of the seven SI base units. 

71'47 立体角  
弧度的定义， 角度对应的弧长与半径的比值   

立体角 把弧度推广到三维。  

从圆心出发的一个锥的面积与半径平方的比值。   

Ω = A / r²  
球的整个立体角就是 4π 。 球的表面积是 4πr². 

74'36 单位立体角  也叫微分立体角    
前面不管了 


结论是 `dω = sinθ dθ dφ`   

77'50 
ω 表示三维空间的一个方向 可以用 θ φ 表示出来。  
I intensity
I = φ / 4π 


80' 生活小知识
白炽灯介绍  


## 第15节 光线传播和全局光照 Ray Tracing 3 (Light Transport & Global Illumination)

0'27 作业  

1'49 为什么老拖堂  
多问概念性的问题  
暑假时可以有实时渲染课程  

4'28 上节回顾  

5'40 本节大概  

6'08 复习上节概念  
Radiant flux(power 用的多吧)  单位时间的能量  
Radiant intensity  单位立体角的上能量  

微分立体角 用 θ φ 表示出一个极小的立体角差量  

11'40 单位面积上的能量(power)  Irradiance  
Definition: The Irradiance is the power per(perpendicular/projected) unit area incident on a surface point.  
指的是垂直方向的面积。  
重点: power per unit area
对比: power per unit solid angle  就是 intensity  
```
     _   dφ(x)
E(x) = ---------
          dA

[ W ][ lm       ]
[---][---- = lux]
[ m²][  m²      ]
```

13'35 Lambert's cosine law  
图示演示清楚  

15'50 为啥有四季  
因为不垂直和垂直的能量不一样  

16'10 Irradiance Falloff

E = φ/4πr²  

18'28 Radiance  
Radiance is the fundamental field quantity that describes the distribution of light in an environment .   
- 与光线有关 Radiance is the quantity associated with a ray  
- 渲染主要就是计算这个 Rendering is all about computing radiance

19'10 Radiance 定义  
Definition: The radiance (luminance) is the power emitted, reflected, transmitted or received by a surface, per unit solid angle, per projected unit area.   
每单位角每单位面积上的能量   
```
       _  d²φ(p,w)
L(p,w) = -----------
          dωdAcosθ

[  W  ][cd     lm        ]
[-----][-- = ------ = nit]
[sr m²][m²    sr m²      ]
```

22' 可以与前面两个概念联系起来  

Radiance: Irradiance per solid angle  
Radiance: Intendity per projected unit area  
            dI(p, ω)
L(p, ω) = ------------
            dAcosθ


26'04 Irradiance Radiance 用得非常多  
Irradiance 单位面积上接收的所有能量  
Radiance  单位面积在某方向上接收的能量  
Radiance 在所有方向上积分起来就是 Irradiance.  (积分就是求和)

29'01 双向反射分布函数 BRDF Bidirectional Reflectance Distribution Function  
用吸收和发射能量来理解反射  

Differential irradiance incoming: dE(ωᵢ) = L(ωᵢ)cosθᵢdωᵢ   
Differential radiance exiting(due to dE(ωᵢ)): dLᵣ(ωᵣ)   

BRDF 就是表示在一个方向上反射出的 Radiance 与接收到的 Irradiance 的比值  

34'01 BRDF 定义  
The Bidirectional reflectance distribution function (BRDF) represents how much light is reflected into each outgoing direction ωᵣ from each incoming direction.   

```
                dLᵣ(ωᵣ)         dLᵣ(ωᵣ)      [ 1 ]
fᵣ(ωᵢ -> ωᵣ) = ---------- = ---------------- [---]
                dEᵢ(ωᵢ)      Lᵢ(ωᵢ)cosθᵢdωᵢ  [ sr]
```
描述了光线和物体是怎么作用的。  
BRDF 定义了材质  

36'48 计算所有反射 反射方程  The Reflection Equation  
```
Lᵣ(p, ωr) = ∫   fᵣ(p,ωᵢ->ωᵣ)Lᵢ(p,ωᵢ)cosθᵢdωᵢ 
             H²
```

40'02 渲染方程 递归方程  Challenge: Recursive Equation  
除了光源，还有其它物体反射过来的光线  

The Rendering Equation  43'-45'  
    ....
现在代图形学的基础，不敢写了。   

46'55 理解渲染方程  
点光源的方程有了  
多个点光源就加起来  
面光源就当做多个点光源积分起来  
其它反射的也加起来  

简写  

L = E + KL  

L = E + KE + K²E + K³E + ...

58'05 全局光照  
间接光照的集合  

60'02 图片演示  
玻璃要透光需要更多次的折射计算  

65'24 简单介绍怎么解全局光照 渲染方程  
路径追踪就是一种解渲染方程的方式  

65'50 概率论简介 Probability Review  
概率论说的都是随机变量  

68'02 随机变量的期望值  Expected value of a random variable  

概率密度函数  PDF Probability Density Functions  

69'39 在连续情况下我们如何去描述变量和它的分布  
求和等于1 变为 积分等于1


## 第16节 Ray tracing 4  (Monte Carlo Path Tracing)

0' 广告 NYU 实习生  

1'39 前面的又难又不难  

3'49 这门课最难的部分就到这节了  

4' 上节回顾  

PDF 性质   p(x) >= 0  and ∫p(x)dx = 1   
期望值  E[x] = ∫xp(x)dx  

9'06 蒙特卡洛积分 Monte Carlo Integration
随机采样的方法  
```
           1   N  f(Xᵢ)
∫f(x)dx = ---  ∑ ------       Xᵢ ~ p(x)
           N  i=1 p(Xᵢ)
```

17'50 注意点  
- 采样越多，结果越准  
- 在 x 上采样， 在 x 上积分  

20'37 路径追踪 Path Tracint

Whitted-style ray tracing
回头思考，这个ray tracing 是对的吗？  
Path tracing 就是来解决 ray tracing 中的不正确。  

22'30 例一  
Specular 镜面材质
Glossy 反光但不那么镜面 材质的反射   

The Utah teapot  一个有名的模型 

24'49 例二  
还在考虑全局光照的漫反射光线  

The Cornell box  

28'50 Whitted-style ray tracing is wrong  
渲染方程是正确的  
```
Lₒ(p, wₒ) = Lₑ(p, wₒ) + ∫  Lᵢ(p, wᵢ)fᵣ(p, wᵢ, wₒ)(n·wᵢ)dwᵢ 
                         Ω⁺
```

29'42 解这个方程的难点  
- 是个积分  
- 积分时还有递归的其它光线   

30'40 如何积分  
Monte Carlo Integration  

采样，代入公式 就能计算了   

37'50 这就算是能写出算法了  


42' 没打到光源， 打到其它物体的情况  


45'15 问题  
1 光线数量会爆炸  
    把N设为1，就不会爆炸，但会有噪声

52'05 问题2  
递归出口   
    俄罗斯轮盘赌  Russian Rouletter (RR)  

60'10 方法正确了，速度不快  

改成在光源上采样， 在光源上积分  

71'01 拆解结果  
分为光源直接的采样和其它反射的贡献  

74'06 小问题  
光源贡献能否到达物体？ 也要判断一下   

76'50 Some Side Notes  
- Path tracing (PT) is indeed difficult  
- Is it still "Introductory"? 
    not really, but it's "modern"

78'26 看图可以得到，PT 是 100% 真实的算法，能得到照片级真实感的图片  

79'46  
- 以前
    Ray tracing = whitted-style ray tracing  

- Modern  
    - The general solution of light transport,


81'50 怎样均匀采样  

82'30 选怎样的 PDF 

83'15 随机数影响大么  
- Yes! 

84'06 可以结合保各种采样方法么
- Yes

84'40   
像素要不要加权平均
。。。
。。。


## 第17节 材质与外观 Materials and Appearances  

2'01 自然界的材质外观  

7'50 程序中的材质  
Material = BRDF  

11'09 Diffuse/ Lambertian Material  

15'01 漫反射公式  

BRDF 的值  fᵣ = ρ / π ,    ρ -- albedo(color)  
范围就是从 0 到 1/π 


16'07 抛光的金属  
有镜面又没那么镜面   glossy  

17'18 透明物体  
有反射有折射  

19'40 反射的公式  
`wₒ + wᵢ = 2cosθ*n = 2(wᵢ·n)n`  
`wₒ = -wᵢ + 2(wᵢ·n)n`  

21'03 角度拆成立体角  
`竖直方向上  θₒ = θᵢ ， 水平方向上 φₒ = (φᵢ + π) mod 2π `


23'48 图示镜面反射  
镜面的BRDF并不好写  

25'13 折射  Specular Refraction  

焦散  是因为聚焦而不是散射  

27'11 折射定律 斯奈尔定律 Snell's Law
ηᵢsinθᵢ = ηₜsinθₜ  η 折射率    

立体角拆分后   ψₜ = ψᵢ +- π   

30'33 求折射角公式

ηᵢsinθᵢ = ηₜsinθₜ  
cosθₜ = sqrt(1-sin²θₜ) = sqrt(1 - (ηᵢ/ηₜ)²sin²θᵢ) = sqrt(1 - (ηᵢ/ηₜ)²(1 - cos²θᵢ)

由公式得出，在入射折射率大于出射折射率的时候，有可以发生全反射。  

32'40 Snell's Window / Circle

34'54 BSDF  
BRDF BTDF  R 反射 T 折射  
它们统称为 BSDF  ， S 散射  

35'30 菲涅尔项 Fresnel Reflection / Term  
与表面垂直与平行的光线反射量是不同的  

绝缘体与导体的菲涅尔项是不同的。  

40'48 菲涅尔项公式
标准公式很麻烦的  

有个近似公式，计算简单的  

42'57 微表面材质 Microfacet Material   
只要离得足够远，小细节就看不见。  

46'13 Microfacet Theory  
Rough surface  
- Macroscale: flat & rough  
- Microscale: bumpy & specular  
从远处看是材质或者说外观  
从近处看是几何  


48'07 Microfacet BRDF  
glossy  
defuse  

讲公式  
很长~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

55'03 图片演示  
PBR 就是用的微表面模型   

57'32 区分材质的方式  Isotropic / Anisotropic Materials (BRDFs)  
各向同性 / 各向异性 材质  

62'44 图片演示各向异性  

64'08 尼龙  

64'50 天鹅绒   

66'20 BRDF 属性  
- 非负的  
- 线性的  
- 可逆性 交换入射出射得到同样的值  
- 能量守恒 Energy conservation 
- 各向同性 vs. 各向异性  


71'28 测量 BRDFs Measuring BRDFs

76'38 测量完要存储起来  
MERL BRDF Database  


## 第18节 Advanced Topics in Rendering  

1' 最近作业安排  

2' 本课内容，只讲大概  

3'53 高级光线传播  Advanced Light Transport  

4'45 有偏和无偏 的积分近似    
无偏: 期望值不变，都是要的值
有偏: 其它的  
    特殊情况，样本足够多，期望会收敛到正确值，这种叫一致的。  

7'19 双向路径追踪  

11'16 大都市光线追踪？？？？ Metropolis Light Transport (MLT)


19'55 光子映射 Photon Mapping  
非常适合用来渲染焦散 (caustics)  

30'27 Vertex Connection and Merging  
没连接的点假装可以连起来  

32'05 Instant Radiosity(IR)
光源照到的点也转换成光源对待  

问题:1 有些地方会不正常发光   
     2 不能做 glossy 的物体

36' 一小波回答问题  

工业界用什么方法 ， path tracing (可靠)

37'36 高级外观建模 Advanced Appearance Modeling  
对于表面模型来说，外观就是材质， 材质就是BRDF  
- Non-surface models
    - Participating media
    - Hair / fur/fiber (BCSDF)
    - Granular material
- Surface models
    - Translucent material (BSSRDF)
    - Cloth
    - Detailed material (non-statistical BRDF)
- Procedural appearance 


38'44 非表面模型  
散射介质/参与介质  participating Media   
雾 云之类的  

40'58 相位函数  

41'25 散射介质渲染  

42'48 应用  
稀的是云雾  
厚的有流体部分穿过模拟  

45'24 头发表现  hair appearance  

47'29 Marshner Model  

51'59 皮毛表现 Fur Appearance
比人的头发，要加上中间的髓质  

55'  双层圆柱的模型  


58'13 颗粒材质 Granular Material  
一粒一粒的模型 米面沙豆子等  


60' 表面模型 Surface Models
玉石 半透明物体(其实指的不光是纯半透明，是透明还要加上散射，出来方向就乱了)   

62'31 次表面散射  
可以理解为对 BRDF 概念的延伸 -> BSSRDF  
SS: 次表面散射


65' Dipole Approximation [Jensen at al. 2001]  
近似次表面散射  

68'11 
十个渲染得最真实的人类模型  
https://cgelves.com/10-most-realistic-human-3d-models-that-will-wow-you/

68'30 布料 Cloth

- 当成平面渲染
- 当成散射介质渲染
- 渲染实际的纤维

74'37 Detailed Appearance: Motivation  
为什么不真实呢 (太完美)  
真实世界是不完美的。。。

77'59 微表面模型 Recap: Microfacet BRDF

87'08 程序化生成的表面/材质/外观 Procedural Appearance

91'12 答疑  

## 第19节 相机 透镜 光场 Cameras, Lenses and Light Fields  

1' 这周课程安排简介  

什么时候放大作业  

3'28 图像=合成+捕捉 Imaging = Synthesis + Capture  

5'40 What's happening inside the camera?  

6'20 小孔&透镜 Pinholes & Lenses From Image on Sensor
小孔成像  

8'13 Shutter(快门)

8'30 Sensor(传感器)

9'02  Why not sensors without lenses?  
都就糊了  

the sensor records irradiance  , 记录不了 randiance  

10'40 Pinhole Camera  
针孔相机没有深度(景深)  不会模糊  

12'48 视场 Field of view (FOV)  
表示能看到多大的范围   

14' 小孔相机的 FOV  

FOV = 2arctan(h/2f)   

15'52 Focal Length v. Field of View  
习惯上用固定大小的胶片(35mm  36x24mm)的焦距来表示视场。   
焦距:  
17mm 是广角， 17mm is wide angle 104度  
50mm is a "normal" lens 47度  
200mm is telephoto lens 12度

17'56 图片演示  
不同的FOV  

19' Effect of Sensor size on FOV  

20'11 传感器大小 Sensor Sizes  
相机机身越大越好， 镜头越长越大越好  

21'08 Maintain FOV on smaller sensor?  
缩短 field length  

21'50 曝光 Exposure
H = T x E  
Exposure = time x irradiance  
对着暗的场景就把快门放慢， 得到大的曝光  

拍照记录的是总共的能量， 不是单位时间的能量  

时间由快门决定

24'12 Irradiance 是由什么决定的  
- 光圈 Power of light falling on a unit area of sensor  
- Controlled by lens aperture and focal length  

24'50 相机控制总结  
- 光圈大小 Aperture size
    - Change the f-stop by opening/closing the aperture (if camera has iris control)
- 快门 shutter speed  
    - change the duration the sensor pixels integrate light
- ISO gain(感光度) 数字调节   
    - change the amplification (analog and /or digital) between sensor values and digital image values  

27'57 图示演示不同配置  

30'31 ISO 变大为什么噪声大了  
因为放大信号时把噪声也放大了  

32'23 ISO(gain)  


33'15 F-Number(F-Stop): Exposure Levels  
Written as FN or F/N. N is the f-number.  
N 就是直径的倒数  

34'57 快门 Physical Shutter(1/25 Sec Exposure)  

快门的影响
运动模糊 Motion blur: handshake, subject movement  
    因为快门打开是有一个过程的
Doubling shutter time doubles motion blur  

减轻运动模糊可以提高快门速度，但曝光会降低  

运动模糊使人感觉快  

41'38 Rolling shutter
Rolling shutter: different parts of photo taken at different times  

42'58 Constant Exposure: F-Stop vs Shutter Speed  
Example: there pairs of aperture and shutter speed give equivalent exposure  

F-Stop:  1.4    2.0   2.8   4.0  5.6  8.0  11.0 16.0  22.0  32.0  
Shutter: 1/500 1/250 1/125  1/60 1/30 1/15 1/8   1/4   1/2   1

If the exposure is to bright/dark, may need to adjust f-stop and /or shutter up/down.  

45'19 高速和慢速(延时)摄影 Fast and slow photography  

48'01 薄透镜近似 Thin Lens Approximation 

49'40 理想化的透镜  

52'05 薄透镜公式 The Thin Lens Equation  
1/f = 1/zi + 1/z0   
zi 物距  
z0 像距  

54' 证明一下  

55'54 软件演示  

56'48 Defocus blur  

57'12 Computing Circle of Confusion(CoC) Size  
像本来是一个点，没落在感光器上，拖远就成了一个圆  

63'56  

64'12 模拟透镜进行渲染 Ray Tracing Ideal Thin Lenses  

65'17 怎么做呢  
加上透镜的折射  

69'16 景深 Depth of Field
场景中能开成图像清晰的范围  

76'01 光场 Light Field / Lumigraph  下节讲  


## 第20节 Color and Perception  
0' 作业提交情况  
作业8是绳子模拟器  

Aesthetics 审美很重要  

09'45 开始这节课  

10'01 光场/光场 Light Field /Lumigraph   
不同组织起的名，同一个东西  

11'15 图示演示  

13'33 全光函数 The Plenoptic Function  

color snapshot  

七个维度描述整个世界能看到的内容   

18'14 定义光线  

P(θ,φ,Vx,Vy,Vz)

20'45 定义光场  
在任何位置向任何方向去的一个光的强度  (在包围盒表面上的，可看作是二维)  

22'40  
光场的好处:
从任意位置都可以看向物体

24'24   
同步理解:  
取一平面，右面是发光物体，左面是观测

u,v s,t  两点组合成线，表示光场 。 记录所有可能的光的位置和方向。   

27'23 另一种理解方式  

30'42 光场摄像机   
正向的是一个相机矩阵  

34'38 反向的光场照相机 The Lytro Light Field Camera  
先拍照，记录光场信息，后调节拍照参数 (焦距 光圈等) 

39'50 原理简介  
把原先记录的一个像素变成了记录一个像素上进来的所有光线。  

41'50 怎样得到正常照片  
每个位置的记录只取一个方向的记录就可以了  

46'05 缺点  
分辨率不足  
高成本  


48'16 小总结  

49'22 Physical Basis of Color  

51' 谱功率密度  

53'19 什么是颜色  What is Color?  
颜色是人的感知  Color is a phenomenon of human perception; it is not a universal property of light   

different wavelengths of light are not "colors"  

54'28  Biological Basis of Color

55'01 人眼生理基础  

55'32 视网膜 Retinal photoreceptor cells:rods and cones   
视杆/棒状细胞  Rod cells
锥形细胞 Cone cells  

锥形细胞分为三类  
s-cone m-cone l-cone  
s 小波长 高频率
m 中波长  
l 长波长  

58'30 不同人的三种细胞分布是不一样的  

59'40 Tristimulus Theory of Color  
Tristimulus 三色刺激 / 三色激励   

每种细胞感知的结果就是对所有光的感知积分起来  

62'26 Metamerism (同色异谱)  
光谱不一样， 看起来颜色是一样的   

64'26 color reproduction /  matching
颜色如何混合  
RGB 电脑里一般用加色系统 

画画用的是减色系统，颜色加加加就黑了  

65'56 加色匹配  Additive Color Matching Experiment  

68'05 CIE RGB color matching experiment  

72'09 颜色空间  Standard Color Spaces  

gamut(色域) 是有限的  

73'18 A universal color space: CIE XYZ  

77'52 色域 Gamut  

80'00 Perceptually Organized Color Spaces  

80'20 HSV Color Space (Hue-Saturation-Value)  
HSV  有的也叫 HSL   

82'12 `CIELAB Space (AKA L*a*b*)`  

85' 一互补色真好玩  

87'05 视觉错觉

89'09 减色系统 CMYK: A subtractive color space 

92' 答疑   


## 第21节 动画/模拟 Animation

3' 今天的内容  

Introduction to Computer Animation 
- History
- keyframe animation
- Physical simulation
- Kinematics
- Rigging  

5'44 Animation  
Bring things to life   

An extension of modeling  

8'52 早期动画 First Animation  
- 只有画  
- 圆盘上画，轮着看  
- 电影  

11'11 第一部 Hand-drawn Feature-Length 动画 
1937年 白雪公主  

1963年 遥控笔  数字动画  

早期动画  

1993年 侏罗纪公园 

1995年 玩具总动员 第一部完全电脑生成的动画

2009 天降美食  

2019 冰雪奇缘  

16'32 关键帧动画 keyframe animation  

19'21 关键帧插值 keyframe interpolation  

21'01 物理模拟/仿真 Physical Simulation  

F = ma  Force = Mass Acceleration  

建立好受力的模型  

24'45 液体模拟  
1 模拟水滴是怎么运动的  
2 渲染出所有水滴  

25'34 质点弹簧系统 Mass Spring System: Example of Modeling a Dynamic System  
- 绳子  
- 头发  
- 面料/布料    


28'37 a simple spring  
基本单元就是一个弹簧连接着两个质点  

力  f(a->b) = ks(b-a)    f(b->a) = -f(a->b)  

rest length : l   没用力时的长度   


f(a->b) = ( ks (b-a) /||b-a||  ) (||b-a|| - l)

31'32 问题  
不会停下来  

32'03 所以要引入摩擦力  
记号 头上一个点表示速度， 头上两个点表示加速度  
一个点表示一阶导数，两个点表示二阶导数   
damping  
        .
f = -kd b  

34' 摩擦力只能表示外面，不能表示内部的力  

38'23 最终结果  


39'41 Structures from Springs  
各种弹簧结构  

40'45 现有问题  
模拟布  
    切变会有影响  
    对折效果不对  

42'43 改进  
再加些对角线弹簧  

竖着折还是不太好， 再加些间隔连接。  

47'30 演示  

48'20 有限元方法  
多用于汽车碰撞  

49'38 粒子系统 Priticle Sysem


59'46 运动学 Forward Kinematics
正向运动学  
骨骼连接类型  
钉上，Pin 可以在平面内
Ball 球连接
Prismatic joint(translation) pin 可以有点移动

62'30 计算  
正向 一步一步算就行了  


63'21 Kinematics Pros and Cons  


64'03 逆运动学/反向运动学 Inverse Kinematics  
解起来很难  
而且解不唯一  
有时候还无解   

66'47 一些优化方法  

68'24 Rigging  
Rigging is a set of higher level controls on a character thar allow more rapid & intuitive modification of pose, deformations, expression, etc.  

import  
- like strings on a puppet  
- Captures all meaningful character changes  
- Varies from character to character  

Expensive to create  
- manual effort  
- requires both artistic and technical training  

70'33 动画示例  

71'29 Blend Shapes  

72'52 Motion Capture  

78'37 Challanges of Facial Animation  

81'01 The Production Pipeline  

86'12 下节预告  


## 第22节 Animation Cont  

0' 课前安排  

3'49 今天的话题  
欧拉方法  
Instability and improvements   

5'11 Single Particle Simulation  

v(x, t)  在位置 x, 时间 t 的 速度 v  


dx   . 
-- = x = v(x, t)   一阶常微分方程   
dt

我知道一个量的微分是多少，推出这个量是多少，就是常微分方程  
不存在对其他变量的微分  

8'48 Solving for Particle Position  

8'57 Euler's Method  
对时间进行离散化   

欧拉方法就是所有量都用上一帧的，直接估算出下一帧的

 t+Δt     t      .t  
x      = x   + Δtx  

.t+Δt    .t      ..t
x      = x   + Δt x


11'59 问题  
步长大就很不准  
步长越小越精确  

不准确，稳定性很快会出问题   

ex. 在同心圆场中一定会飞出去  
    上下力场的正反馈  

17'15 例子  
直播翻车现场  

18'09 Combating Instability   
中点法 
自适应改步长法
隐式方法
不是基于物理的方法  

19'38 中点法 MidPoint Method  
比欧拉方法准确一些  
相当于用了两次的欧拉方法   

21'27 中点法公式  
就不写了  

22'34 Adaptive step size  
看划分两部分与一步结果差得远不远，远就继续分，差不多就不用分了  

26'03 隐式欧拉方法/也叫反向/后向欧拉方法  
用下一时刻的速度来计算，而不是上一时刻的。 这就是它与欧拉方法的区别  

稳定性好  

29'39 怎么定义稳定性   
以及有多稳定  

隐式欧拉方法是一阶的  
Implicit Euler has order 1, which means that  
    - Local truncation error: O(h²) and  
    - Global truncatin error: O(h)   (h is the step, i.e. Δt)

h n次方的意思: O(h) 的意思是 Δt 减少一半，期望得到的误差也减少一半  

除数是越高越好， 2次方的误差就会减少到 1/4, 3次方就 1/8 ....  

33'05 Runge-Kutta Families  
龙格库塔方法  
A family of advanced methods for solving ODEs(常微分方程)  
    - Especially good at dealing with non-linearity  
    - It's order-four version is the most widely used, a.k.a. RK4  

Initial condition:

dy
-- = f(t,y), y(t0) = y0.   
dt


RK4 solution:  

yₙ₊₁ = yₙ + 1h/6(k₁ + 2k₂ + 2k₃ + k₄), tₙ₊₁ = tₙ + h    

where  

k₁ = f(tₙ, yn)  
k₂ = f(tₙ + h/2, yₙ + hk₁/2)  
k₃ = f(tₙ + h/2, yₙ + hk₂/2)  
k₄ = f(tₙ + h, yₙ + hk₃)  

37'29 Position-Based /Verlet Integration  


40'03 刚体模拟 Rigid Body Simulation  

Simple case  
    - Similar to simulating a particle  
    - Just consider a bit more properties  

```
          .
   [X]   [X]
d  [θ]   [ω]
    .   
-- [X] = [F/M]
dx [ω]   [Γ/I]
```

42'36 液体模拟例子 Fluid simulation  

基本假设  
    水是由刚体小球组成
    水是不可压缩的
    密度不可改变  

47'49 机器学习？下降梯度？？？  
听不懂了  
Update? Just gradient descent!  

49'45 Eulerian vs. Lagrangian  
质点法 Lagrangian approach  拉格朗日方法  
模拟小水滴的那种  
盯着每一只  



网格法 Eulerian approach  
把整个空间分成网格， 看网格随时间怎么变化  

52'56 烤兔子 Material point method (MPM)   
混合两个方法  
 
55'22 下一步怎么学  

realtime rendering 这本书  

几何  微分几何  离散微分几何 拓扑 流行？？  


57'53 广告  

67'30 Any other rendering courses?  

75'01   
- It is not because of teaching that I was recognized by the community..., but for research!  
- In rendering research, I hold the human record of 7 first-authored SIGGRAPH papers during Ph.D.  
- Join my group and become legendary!  













